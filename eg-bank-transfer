// ==UserScript==
// @name         Evergore Bank Transfer
// @namespace    https://evergore.de/
// @version      0.2b
// @description  Fügt zwei Button hinzu, um Rohstoffe, Handwerksmaterialien und Gold komplett in das Inventar bzw. in die Bank zu transferieren.
// @author       mofte
// @match        https://evergore.de/lenoran?page=bank
// ==/UserScript==

(function () {
    'use strict';

    // Funktion zum Stylen der Buttons
    function styleButton(button) {
        button.style.padding = '5px 10px';
        button.style.cursor = 'pointer';
        button.style.border = '1px solid #ccc';
        button.style.borderRadius = '5px';
        button.style.margin = '5px';
        button.style.marginBottom = '20px';
        button.style.backgroundImage = 'url("https://evergore.de/skins/komo/gfx/th.png")';
        button.style.backgroundSize = 'cover';
        button.style.color = 'black'; // Textfarbe auf dem Hintergrund
        button.style.fontWeight = 'bold';
    }

    // Überschrift erstellen
    const description = document.createElement('span');
    description.textContent = 'Rohstoffe, HWM und Gold';
    description.style.fontWeight = 'bold';

    // Button für Inventar erstellen
    const toInventoryButton = document.createElement('button');
    toInventoryButton.textContent = 'in das Inventar';
    styleButton(toInventoryButton);

    // Button für Bank erstellen
    const toBankButton = document.createElement('button');
    toBankButton.textContent = 'in die Bank';
    styleButton(toBankButton);

    // Funktion für den Button "in das Inventar"
    toInventoryButton.addEventListener('click', () => {
        const rows = document.querySelectorAll('tr'); // Alle Zeilen in der Tabelle
        let goldSet = false;

        rows.forEach(row => {
            const text = row.textContent.toLowerCase();

            // Prüfen, ob die Zeile "Rohstoff" oder "Handwerksmaterial" enthält
            if (text.includes('rohstoff') || text.includes('handwerksmaterial')) {
                const input = row.querySelector('input[type="number"]');
                const id = input?.getAttribute('id');

                // Setze Wert nur bei id="p1"
                if (id === 'p1' && input) {
                    input.value = 9999; // Wert setzen
                    console.log('Rohstoff/Handwerksmaterial mit id="p1" gefunden, Wert auf 9999 gesetzt.');
                }
            }
        });

        // Setze bankgold auf 99999
        const bankgoldInput = document.querySelector('input[name="bankgold"]');
        if (bankgoldInput) {
            bankgoldInput.value = 99999;
            goldSet = true;
            console.log('Bankgold auf 99999 gesetzt.');
        } else {
            console.error('Kein Bankgold-Feld gefunden.');
        }

        // Klick auf den "Durchführen"-Button auslösen
        const executeButton = document.querySelector('button[type="submit"], input[type="submit"]');
        if (goldSet || executeButton) {
            executeButton.click();
            console.log('"in das Inventar"-Transfer abgeschlossen.');
        } else {
            alert('Keine Rohstoffe, Handwerksmaterialien oder Gold gefunden.');
        }
    });

    // Funktion für den Button "in die Bank"
    toBankButton.addEventListener('click', () => {
        const rows = document.querySelectorAll('tr'); // Alle Zeilen in der Tabelle
        let goldSet = false;

        rows.forEach(row => {
            const text = row.textContent.toLowerCase();

            // Prüfen, ob die Zeile "Rohstoff" oder "Handwerksmaterial" enthält
            if (text.includes('rohstoff') || text.includes('handwerksmaterial')) {
                const input = row.querySelector('input[type="number"]');
                const id = input?.getAttribute('id');

                // Setze Wert nur bei id="p2"
                if (id === 'p2' && input) {
                    input.value = 9999; // Wert setzen
                    console.log('Rohstoff/Handwerksmaterial mit id="p2" gefunden, Wert auf 9999 gesetzt.');
                }
            }
        });

        // Setze herogold auf 99999
        const herogoldInput = document.querySelector('input[name="herogold"]');
        if (herogoldInput) {
            herogoldInput.value = 99999;
            goldSet = true;
            console.log('Herogold auf 99999 gesetzt.');
        } else {
            console.error('Kein Herogold-Feld gefunden.');
        }

        // Klick auf den "Durchführen"-Button auslösen
        const executeButton = document.querySelector('button[type="submit"], input[type="submit"]');
        if (goldSet || executeButton) {
            executeButton.click();
            console.log('"in die Bank"-Transfer abgeschlossen.');
        } else {
            alert('Keine Rohstoffe, Handwerksmaterialien oder Gold gefunden.');
        }
    });

    // Text und Buttons vor dem Formular einfügen
    const bankForm = document.querySelector('form[name="bankform"]');
    if (bankForm) {
        bankForm.parentNode.insertBefore(description, bankForm);
        bankForm.parentNode.insertBefore(toInventoryButton, description.nextSibling);
        bankForm.parentNode.insertBefore(toBankButton, toInventoryButton.nextSibling);
    }
})();
